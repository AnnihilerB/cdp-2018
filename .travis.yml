
language: node_js
services:
- docker
node_js:
- '8'
install:
- docker-compose -f docker-compose-dev.yml up --build -d
- npm install
before_script:
- curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
- chmod +x ./cc-test-reporter
- ./cc-test-reporter before-build
script:
- npm test
after_script:
- ./cc-test-reporter after-build -t lcov --debug --exit-code $TRAVIS_TEST_RESULT

deploy:
  provider: script
  script: bash ./scripts/deploy.sh
  on:
    tags: true
    branches:
      only:
        - /v\d+\.\d+/